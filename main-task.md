# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ Symfony

## API –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫—Ä–∏–ø—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä—Å–∫–æ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è

> **–ü—Ä–∞–≤–∏–ª–æ –≤–µ–¥–µ–Ω–∏—è:** –ø—Ä–∏ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –ø—Ä–æ–µ–∫—Ç–µ (–Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã, –º–∏–≥—Ä–∞—Ü–∏–∏, –∫–æ–Ω—Ñ–∏–≥–∏, –ø–∞–∫–µ—Ç—ã, –∫–æ–º–∞–Ω–¥—ã, API –∏ —Ç.–¥.) —ç—Ç–æ—Ç —Ñ–∞–π–ª –Ω—É–∂–Ω–æ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –¥–æ–ø–∏—Å—ã–≤–∞—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã, –∂—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã. –§–∞–π–ª ‚Äî –µ–¥–∏–Ω–∞—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∏—Å—Ç–æ—Ä–∏—è –∑–∞–¥–∞—á–∏.

> **–ü—Ä–∞–≤–∏–ª–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–ø–æ—Ä—Ç—Ñ–µ–ª—å, API URL, —Å–∏–º–≤–æ–ª—ã, —Ç–∞–π–º–∞—É—Ç—ã –∏ —Ç.–ø.) –∑–∞–¥–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤ `.env`**. –í –∫–æ–Ω—Ñ–∏–≥–∞—Ö (`config/`) ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ `%env(...)%`, –±–µ–∑ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏—è.

> **Docker:** –Ω–∞ —Ö–æ—Å—Ç–µ `vendor` –∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Ç–æ–º `app_vendor` ‚Äî —Ä–∞–∑–Ω—ã–µ. –ü–æ—Å–ª–µ –ª—é–±–æ–≥–æ `composer require` / –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ —Ö–æ—Å—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ: `docker compose -f dev-compose.yml exec app composer install`, –∏–Ω–∞—á–µ –∫–æ–Ω—Ñ–∏–≥ –±—É–¥–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–∞–∫–µ—Ç—ã (–æ—à–∏–±–∫–∞ ¬´component is not installed¬ª).

> **–†–µ–∂–∏–º —Ç–µ—Å—Ç–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã):** –≤ `.env` –≤—ã—Å—Ç–∞–≤–∏—Ç—å `PORTFOLIO_SNAPSHOT_GRANULARITY=second` –∏ `SNAPSHOT_INTERVAL_SECONDS=10`. –¢–æ–≥–¥–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ü–∏–∫–ª: –∫–∞–∂–¥—ã–µ 10 —Å —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ Binance API ‚Üí —Ä–∞—Å—á—ë—Ç ‚Üí –∑–∞–ø–∏—Å—å –≤ `portfolio_snapshot` –∏ `app_log` ‚Üí –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Mercure. –§—Ä–æ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î (GET /api/events, GET /api/portfolio/history) –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –î–ª—è prod: —É–±—Ä–∞—Ç—å `SNAPSHOT_INTERVAL_SECONDS`, –æ—Å—Ç–∞–≤–∏—Ç—å cron –ø–æ –º–∏–Ω—É—Ç–∞–º –∏ `PORTFOLIO_SNAPSHOT_GRANULARITY=hour`.

> **–ü–æ—à–∞–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ ‚Äî —Ñ–∞–π–ª **TEST-RUNBOOK.md** (–ø–æ–¥–Ω—è—Ç–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –º–∏–≥—Ä–∞—Ü–∏–∏, –∑–∞–ø—É—Å–∫ —Å–Ω–∞–ø—à–æ—Ç–∞ –∫–∞–∂–¥—ã–µ 10 —Å, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤, –ë–î, API, –¥–∞—à–±–æ—Ä–¥–∞, Mercure).

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

–£ –∫—Ä–∏–ø—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞ –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –ø–æ—Ä—Ç—Ñ–µ–ª—å:

* **1 BTC**
* **10 ETH**
* **50 SOL**
* **5000 USDT**

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –±—ç–∫–µ–Ω–¥‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ **Symfony**, –∫–æ—Ç–æ—Ä–æ–µ:

1. –ö–∞–∂–¥—ã–π —á–∞—Å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è –≤ USDT
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
3. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞

---

## üéØ –¶–µ–ª—å

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π –ø–æ—á–∞—Å–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```json
[
  {"time": "2026-02-26T10:00:00Z", "amount_usdt": 123456.78},
  {"time": "2026-02-26T11:00:00Z", "amount_usdt": 123789.12},
  {"time": "2026-02-26T12:00:00Z", "amount_usdt": 124001.55}
]
```

---

## üí± –ò—Å—Ç–æ—á–Ω–∏–∫ —Ü–µ–Ω

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å endpoint Binance API **avgPrice**:

* BTC ‚Äî `https://api.binance.com/api/v3/avgPrice?symbol=BTCUSDT`
* ETH ‚Äî `https://api.binance.com/api/v3/avgPrice?symbol=ETHUSDT`
* SOL ‚Äî `https://api.binance.com/api/v3/avgPrice?symbol=SOLUSDT`

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –†–∞—Å—á—ë—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è (–∫–∞–∂–¥—ã–π —á–∞—Å)

```text
total_usdt = BTC_amount * BTC_price
           + ETH_amount * ETH_price
           + SOL_amount * SOL_price
           + USDT_amount
```

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (Doctrine ORM)

–ü–æ–ª—è —Å—É—â–Ω–æ—Å—Ç–∏:

* `id`
* `calculated_at` ‚Äî –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ä–∞—Å—á—ë—Ç–∞
* `amount_usdt` ‚Äî –¥–µ—Å—è—Ç–∏—á–Ω–æ–µ —á–∏—Å–ª–æ

### API endpoint

```
GET /api/portfolio/history
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

* `?hours=24` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —á–∞—Å–æ–≤
* `?from=...&to=...` ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç

–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ (**ASC**).

---

## üß± –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç–∞–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é Symfony
2. –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å `BinancePriceService`

    * HTTP‚Äë–∫–ª–∏–µ–Ω—Ç
    * –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
3. –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å `PortfolioValuationService`
4. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å–æ–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É Symfony:

```
app:portfolio:snapshot
```

5. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ **Monolog**
6. –ù–∞–ø–∏—Å–∞—Ç—å –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω –º–æ–¥—É–ª—å–Ω—ã–π —Ç–µ—Å—Ç *(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)*

---

## ‚è±Ô∏è –ü—Ä–∏–º–µ—Ä Cron

**–ë–µ–∑ Docker (—Ö–æ—Å—Ç):**
```bash
0 * * * * php bin/console app:portfolio:snapshot --env=prod
```

**–° Docker ‚Äî –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:**

1. **Cron –Ω–∞ —Ö–æ—Å—Ç–µ** ‚Äî –∑–∞–¥–∞—á–∞ —Ä–∞–∑ –≤ —á–∞—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (Windows: –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞–Ω–∏–π, Linux: crontab):
   ```bash
   0 * * * * docker compose -f dev-compose.yml exec -T app php bin/console app:portfolio:snapshot --env=prod
   ```
   `-T` –Ω—É–∂–µ–Ω –¥–ª—è –Ω–µ–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞. –î–ª—è prod –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π compose-—Ñ–∞–π–ª –∏ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞.

2. **Cron –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ app** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: –≤ –æ–±—Ä–∞–∑ —Å—Ç–∞–≤–∏—Ç—Å—è –ø–∞–∫–µ—Ç `cron`; –≤ entrypoint —Å–æ–∑–¥–∞—ë—Ç—Å—è `/etc/cron.d/portfolio-snapshot` –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–µ–º–æ–Ω cron. 
3. –ò–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞–¥–∞—ë—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π **`CRON_SNAPSHOT_MINUTES`** (–º–∏–Ω—É—Ç—ã; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60). –í `.env` –∏ –≤ `dev-compose.yml` (app.environment) 
4. –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è `CRON_SNAPSHOT_MINUTES`; –≤ entrypoint –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ `*/N * * * *`. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–æ–¥–Ω–∏–º–∞–µ—Ç cron –≤–º–µ—Å—Ç–µ —Å php-fpm –∏ nginx.

---

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ

1. –ü–æ–ª–Ω—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (GitHub‚Äë—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ –∞—Ä—Ö–∏–≤)
   üìß –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ **[alytvynov@lytvynov-production.com](mailto:alytvynov@lytvynov-production.com)**

2. README —Å:

    * –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
    * –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
    * –∑–∞–ø—É—Å–∫–æ–º cron

3. –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π

---

## ‚è≥ –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**1‚Äì2 —á–∞—Å–∞**

---

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ì–æ—Ç–æ–≤–æ–µ Symfony‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ:

* —Å–æ–±–∏—Ä–∞–µ—Ç —Ü–µ–Ω—ã –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
* —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è
* —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é
* –æ—Ç–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞

---

# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –ø–æ—à–∞–≥–æ–≤—ã–π)

–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞: Symfony 7.4, PHP 8.2, Doctrine ORM 3.6, Doctrine Migrations, –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–∑ `src/`, —Ä–æ—É—Ç–∏–Ω–≥ –ø–æ –∞—Ç—Ä–∏–±—É—Ç–∞–º. –ú–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ `migrations/` (Doctrine). –ò–º–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏–π ‚Äî —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ (–∫–∞–∫ –≤ Laravel), –Ω–∞–ø—Ä–∏–º–µ—Ä `Version20250228140000_CreateAppLogTable`.

---

## –ñ—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)

| –î–∞—Ç–∞ / —ç—Ç–∞–ø | –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ |
|-------------|-------------|
| 2026-02-28 | –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω **symfony/monolog-bundle** (Monolog –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ‚Äî —Å—Ç–∞–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ `composer install` –≤ entrypoint; –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ —Ö–æ—Å—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å `docker compose -f dev-compose.yml exec app composer install`). |
| 2026-02-28 | –î–æ–±–∞–≤–ª–µ–Ω **App\Service\LogManager**: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–≥–µ—Ä—ã `getLogger(string $name, string $type = 'file')` ‚Äî —Ç–∏–ø `file` –ø–∏—à–µ—Ç –≤ `var/log/{name}.log`, —Ç–∏–ø `db` –ø–∏—à–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `app_log`. –í `config/services.yaml` –ø—Ä–∏–≤—è–∑–∫–∞ `$projectDir: '%kernel.project_dir%'`. |
| 2026-02-28 | –ú–∏–≥—Ä–∞—Ü–∏—è **Version20250228140000_CreateAppLogTable** ‚Äî —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `app_log` (id, channel, level, message, context, created_at), –∏–Ω–¥–µ–∫—Å—ã –ø–æ created_at –∏ channel. |
| 2026-02-28 | –í **symfony-docker-performance-setup.md** –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ: Monolog –≤ —Å–ø–∏—Å–∫–µ –ø–∞–∫–µ—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, LogManager –∏ —Ç–∞–±–ª–∏—Ü–∞ app_log. |
| 2026-02-28 | –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω **symfony/http-client**; –≤ `config/packages/framework.yaml` –¥–æ–±–∞–≤–ª–µ–Ω–æ `http_client: true` (–ø. 1.1 –∏ 1.3). |
| 2026-02-28 | **–†–∞–∑–¥–µ–ª 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –¥–æ–±–∞–≤–ª–µ–Ω `config/packages/portfolio.yaml` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `portfolio.amounts` (btc, eth, sol, usdt), `binance.api_base_url`, `binance.symbols`; scoped HTTP-–∫–ª–∏–µ–Ω—Ç `binance_api_client` –≤ framework.yaml (base_uri, timeout 10). |
| 2026-02-28 | **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤ .env:** –ø–æ—Ä—Ç—Ñ–µ–ª—å –∏ Binance –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `.env` (PORTFOLIO_BTC/ETH/SOL/USDT, BINANCE_API_BASE_URL, BINANCE_SYMBOLS). –í `portfolio.yaml` –∏ `framework.yaml` ‚Äî —Ç–æ–ª—å–∫–æ `%env(...)%`. –í main-task.md –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ: –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî —Ç–æ–ª—å–∫–æ –≤ .env. |
| 2026-02-28 | **–†–∞–∑–¥–µ–ª 3. –°—É—â–Ω–æ—Å—Ç—å –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:** —Å—É—â–Ω–æ—Å—Ç—å **App\Entity\PortfolioSnapshot** (id, calculatedAt, amountUsdt decimal 20,8); —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ calculated_at (–æ–¥–∏–Ω —Å–Ω–∞–ø—à–æ—Ç –Ω–∞ —á–∞—Å), –∏–Ω–¥–µ–∫—Å –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É. –ú–∏–≥—Ä–∞—Ü–∏—è **Version20250228160000_CreatePortfolioSnapshotTable** ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `portfolio_snapshot`. |
| 2026-02-28 | **–†–∞–∑–¥–µ–ª 4. BinancePriceService:** –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `BinancePriceServiceInterface` (getAvgPrices), —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `BinancePriceService` (scoped client, LoggerInterface, symbols –∏–∑ params), –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `App\Exception\BinanceApiException`; –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ 4xx/5xx –∏ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞; –ø—Ä–∏–≤—è–∑–∫–∞ –≤ services.yaml –∫ `http_client` –∏ –∫–æ–Ω—Ñ–∏–≥—É Binance. |
| 2026-02-28 | **–†–∞–∑–¥–µ–ª 5. PortfolioValuationService:** `src/Service/PortfolioValuationService.php` ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ BinancePriceServiceInterface, EntityManagerInterface, `%portfolio.amounts%`, `%binance.symbols%`; –º–µ—Ç–æ–¥ `snapshot()`: —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ Binance, —Ñ–æ—Ä–º—É–ª–∞ total_usdt, –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 8 –∑–Ω–∞–∫–æ–≤, `calculatedAt` = –Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Å–∞ UTC; –ø—Ä–∏ UniqueConstraintViolation ‚Äî –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ –±–µ–∑ –æ—à–∏–±–∫–∏. |
| 2026-02-28 | **–†–∞–∑–¥–µ–ª 6. –ö–æ–º–∞–Ω–¥–∞ app:portfolio:snapshot:** `src/Command/PortfolioSnapshotCommand.php` ‚Äî AsCommand (name, description), –≤–Ω–µ–¥—Ä–µ–Ω—ã PortfolioValuationService –∏ LoggerInterface (–æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–≥–µ—Ä); execute() –≤—ã–∑—ã–≤–∞–µ—Ç service->snapshot(), –ø—Ä–∏ —É—Å–ø–µ—Ö–µ ‚Äî info –≤ –ª–æ–≥ –∏ SymfonyStyle success, –ø—Ä–∏ BinanceApiException/Throwable ‚Äî error –≤ –ª–æ–≥ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ Command::FAILURE. |
| 2026-02-28 | **–†–∞–∑–¥–µ–ª 7‚Äì8. API history –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** –∫–æ–Ω—Ñ–∏–≥ `portfolio_history_api.yaml` –∏ .env (PORTFOLIO_HISTORY_MAX_HOURS, PORTFOLIO_HISTORY_DEFAULT_HOURS) ‚Äî –ª–∏–º–∏—Ç—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–ø–∏—Å–∞–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥–µ; —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `PortfolioSnapshotRepository::findForHistory`; –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `Api\PortfolioHistoryController` ‚Äî GET /api/portfolio/history, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã hours –∏–ª–∏ from/to, –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥, –æ—Ç–≤–µ—Ç JSON ASC –ø–æ –≤—Ä–µ–º–µ–Ω–∏; –≤ –∫–ª–∞—Å—Å–∞—Ö –Ω–µ—Ç –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö —á–∏—Å–µ–ª. |
| 2026-02-28 | **–†–∞–∑–¥–µ–ª 11. UI:** –¥–æ–±–∞–≤–ª–µ–Ω –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–ø. 11.1‚Äì11.5); —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã `base.html.twig`, `public/css/app.css`, –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Äî –¥–∞—à–±–æ—Ä–¥ —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ (—Ç–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–∏–æ–¥), –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–µ—Ä–∏–æ–¥–∞ 24—á/7–¥/30–¥, –≥—Ä–∞—Ñ–∏–∫ Chart.js –ø–æ –¥–∞–Ω–Ω—ã–º `GET /api/portfolio/history`, —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∞/–ø—É—Å—Ç–æ/–æ—à–∏–±–∫–∞. |
| 2026-02-28 | **LogManager**: –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç `getLogger(string $name = 'app', string $type = 'file')` ‚Äî –∏–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `app` (—Ñ–∞–π–ª `app.log` –∏–ª–∏ –∫–∞–Ω–∞–ª `app`), –∫–ª–∞—Å—Å –æ—Å—Ç–∞—ë—Ç—Å—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º. –ü–ª–∞–Ω 11.7: –∑–∞–º–µ–Ω—ë–Ω polling –Ω–∞ –ø—É—à (—Ñ—Ä–æ–Ω—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–Ω–∞–ª, –±—ç–∫ —à–ª—ë—Ç –ø–æ –∫–∞–Ω–∞–ª—É ‚Äî Mercure). |
| 2026-02-28 | **–ü—É–Ω–∫—Ç C (–ø—É—à –Ω–∞ —Ñ—Ä–æ–Ω—Ç)**: –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è mercure_public_url –≤ Twig; –Ω–∞ –≥–ª–∞–≤–Ω–æ–π ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–æ–ø–∏–∫ portfolio/snapshots —á–µ—Ä–µ–∑ EventSource, –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ toast ¬´–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ—Ä—Ç—Ñ–µ–ª—é¬ª –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞/–∫–∞—Ä—Ç–æ—á–µ–∫ (load(currentHours)); —Å—Ç–∏–ª–∏ toast –≤ app.css; –≤ —Ä–∞–∑–¥–µ–ª–µ 11.7 –¥–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. |
| 2026-02-28 | **–ü—É–Ω–∫—Ç D (–±–ª–æ–∫ —Å–æ–±—ã—Ç–∏–π)**: —Å–µ–∫—Ü–∏—è ¬´–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π¬ª –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º; –æ–ø—Ä–æ—Å GET /api/events –∫–∞–∂–¥—ã–µ 10 —Å, —Ä–µ–Ω–¥–µ—Ä –¥–∞—Ç–∞/–≤—Ä–µ–º—è, —É—Ä–æ–≤–µ–Ω—å, —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ–Ω—Ç–µ–∫—Å—Ç; —Å—Ç–∏–ª–∏ –≤ app.css; –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ (.events-item--new). |


---

## 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

1.1. **HTTP-–∫–ª–∏–µ–Ω—Ç**  
‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `symfony/http-client` ‚Äî –Ω–∞—Ç–∏–≤–Ω—ã–π HTTP-–∫–ª–∏–µ–Ω—Ç Symfony –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Binance API. –í `config/packages/framework.yaml` –≤–∫–ª—é—á–µ–Ω–æ `http_client: true`.

1.2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**  
‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `symfony/monolog-bundle`. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω **App\Service\LogManager** –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ª–æ–≥–≥–µ—Ä–æ–≤ (file/db). –ö–æ–Ω—Ñ–∏–≥ `config/packages/monolog.yaml` (recipe). –î–ª—è –ø–æ—Ä—Ç—Ñ–µ–ª—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `$logManager->getLogger('portfolio', 'file')` –∏–ª–∏ `'db'`.

1.3. **–í–∫–ª—é—á–∏—Ç—å HTTP-–∫–ª–∏–µ–Ω—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏**  
‚úÖ –í `config/packages/framework.yaml` –¥–æ–±–∞–≤–ª–µ–Ω–æ `http_client: true`.

---

## 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

2.1. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ—Ä—Ç—Ñ–µ–ª—è**  
‚úÖ –§–∞–π–ª `config/packages/portfolio.yaml`: `portfolio.amounts` (btc: 1, eth: 10, sol: 50, usdt: 5000), `binance.api_base_url`, `binance.symbols` (BTCUSDT, ETHUSDT, SOLUSDT).

2.2. **Scoped HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è Binance**  
‚úÖ –í `config/packages/framework.yaml`: scoped client `binance_api_client` —Å `base_uri: '%binance.api_base_url%'`, `timeout: 10`. –°–µ—Ä–≤–∏—Å: `http_client.scoped.binance_api_client`.

2.3. **Monolog**  
‚úÖ –õ–æ–≥–∏ –∫–æ–º–∞–Ω–¥—ã –∏ Binance –ø–∏—à—É—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–≥–µ—Ä (dev.log –≤ dev, stderr –≤ prod). –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª portfolio –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

---

## 3. –°—É—â–Ω–æ—Å—Ç—å –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Doctrine)

3.1. **–°—É—â–Ω–æ—Å—Ç—å `PortfolioSnapshot`**  
‚úÖ `src/Entity/PortfolioSnapshot.php`: –ø–æ–ª—è `id` (int, auto), `calculatedAt` (DateTimeImmutable), `amountUsdt` (decimal 20,8). –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ `calculated_at` (–æ–¥–∏–Ω —Å–Ω–∞–ø—à–æ—Ç –Ω–∞ —á–∞—Å), –∏–Ω–¥–µ–∫—Å –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `(DateTimeImmutable $calculatedAt, string $amountUsdt)`.

3.2. **–ú–∏–≥—Ä–∞—Ü–∏–∏**  
‚úÖ `Version20250228140000_CreateAppLogTable` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `app_log`.  
‚úÖ `Version20250228160000_CreatePortfolioSnapshotTable` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `portfolio_snapshot` (id, calculated_at, amount_usdt), unique + index –ø–æ calculated_at.

---

## 4. –°–µ—Ä–≤–∏—Å Binance (BinancePriceService)

4.1. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å**  
‚úÖ `src/Service/Binance/BinancePriceServiceInterface.php` ‚Äî –º–µ—Ç–æ–¥ `getAvgPrices(array $symbols): array` (symbol => float). –ê–ª–∏–∞—Å –≤ services: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Üí BinancePriceService.

4.2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `BinancePriceService`**  
‚úÖ `src/Service/Binance/BinancePriceService.php`: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Äî `http_client`, `LoggerInterface`, `%binance.symbols%`. GET `/api/v3/avgPrice?symbol={symbol}` –ø–æ –∫–∞–∂–¥–æ–º—É —Å–∏–º–≤–æ–ª—É; –ø–∞—Ä—Å–∏–Ω–≥ JSON `price` ‚Üí float; –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ != 200 –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ `BinanceApiException`. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: `App\Exception\BinanceApiException`.

---

## 5. –°–µ—Ä–≤–∏—Å –æ—Ü–µ–Ω–∫–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è (PortfolioValuationService)

5.1. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**  
‚úÖ BinancePriceServiceInterface, EntityManagerInterface, `%portfolio.amounts%`, `%binance.symbols%` (–≤ services.yaml).

5.2. **–õ–æ–≥–∏–∫–∞**  
‚úÖ –ú–µ—Ç–æ–¥ `snapshot()`: —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ `getAvgPrices($symbols)`; —Ñ–æ—Ä–º—É–ª–∞ `total_usdt = btc*price_btc + eth*price_eth + sol*price_sol + usdt`; –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 8 –∑–Ω–∞–∫–æ–≤; `calculatedAt` ‚Äî –Ω–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Å–∞ UTC; –æ–¥–∏–Ω `persist` + `flush`.

5.3. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ —á–∞—Å—É**  
‚úÖ `calculatedAt` –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –≤–Ω–∏–∑ –¥–æ —á–∞—Å–∞ (UTC). –ü—Ä–∏ `UniqueConstraintViolationException` ‚Äî clear –∏ –≤—ã—Ö–æ–¥ –±–µ–∑ –æ—à–∏–±–∫–∏ (—Å–Ω–∞–ø—à–æ—Ç –∑–∞ —ç—Ç–æ—Ç —á–∞—Å —É–∂–µ –µ—Å—Ç—å).

---

## 6. –ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ app:portfolio:snapshot

6.1. **–ö–ª–∞—Å—Å**  
‚úÖ `src/Command/PortfolioSnapshotCommand.php`, –∏–º—è `app:portfolio:snapshot` —á–µ—Ä–µ–∑ #[AsCommand].

6.2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**  
‚úÖ PortfolioValuationService, LoggerInterface (–∫–∞–Ω–∞–ª portfolio —á–µ—Ä–µ–∑ services.yaml).

6.3. **execute()**  
‚úÖ –í—ã–∑–æ–≤ service->snapshot(); –ø—Ä–∏ —É—Å–ø–µ—Ö–µ ‚Äî logger->info + SymfonyStyle->success, return SUCCESS; –ø—Ä–∏ BinanceApiException ‚Äî logger->error —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, return FAILURE; –ø—Ä–∏ –ø—Ä–æ—á–∏—Ö Throwable ‚Äî —Ç–æ –∂–µ, cron –≤–∏–¥–∏—Ç –Ω–µ–Ω—É–ª–µ–≤–æ–π –∫–æ–¥.

6.4. **–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã**  
‚úÖ –í AsCommand: description ¬´–°–æ–∑–¥–∞—ë—Ç –ø–æ—á–∞—Å–æ–≤–æ–π —Å–Ω–∞–ø—à–æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è –≤ USDT (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è cron –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é)¬ª.

---

## 7. API GET /api/portfolio/history

7.1. **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä**  
‚úÖ `src/Controller/Api/PortfolioHistoryController.php`, –º–∞—Ä—à—Ä—É—Ç `GET /api/portfolio/history` (prefix /api –∏–∑ routes).

7.2. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞**  
‚úÖ `hours` (int) –∏–ª–∏ –ø–∞—Ä–∞ `from` + `to` (ISO 8601). –í–∞–ª–∏–¥–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Å—Ö–µ–º–∞; –ª–∏–º–∏—Ç—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (`portfolio_history.max_hours`, `portfolio_history.default_hours`), –±–µ–∑ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö —á–∏—Å–µ–ª –≤ –∫–ª–∞—Å—Å–µ. 400 –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å —Ç–µ–∫—Å—Ç–æ–º.

7.3. **–õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∫–∏**  
‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `findForHistory($from, $to, $hours)`; –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∏–∑ hours –∏–ª–∏ from/to; ORDER BY calculated_at ASC.

7.4. **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞**  
‚úÖ JSON-–º–∞—Å—Å–∏–≤ `{"time": "Y-m-d\TH:i:sP", "amount_usdt": float}`, 200. –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

7.5. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**  
‚úÖ ASC –ø–æ –≤—Ä–µ–º–µ–Ω–∏.

**–ö–æ–Ω—Ñ–∏–≥ (–≤—Å–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ):** `config/packages/portfolio_history_api.yaml` + .env: `PORTFOLIO_HISTORY_MAX_HOURS` (–º–∞–∫—Å. —á–∞—Å–æ–≤ –¥–ª—è ?hours=), `PORTFOLIO_HISTORY_DEFAULT_HOURS` (–µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã). –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–ø–∏—Å–∞–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

---

## 8. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

8.1. **PortfolioSnapshotRepository**  
‚úÖ `src/Repository/PortfolioSnapshotRepository.php`, –º–µ—Ç–æ–¥ `findForHistory(?\DateTimeInterface $from, ?\DateTimeInterface $to, ?int $hours): array`. –°—É—â–Ω–æ—Å—Ç—å PortfolioSnapshot —Å `repositoryClass`.

---

## 9. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≥—Ä–∞–Ω–∏—Ü—ã

9.1. **Binance**  
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ/5xx/–Ω–µ–≤–µ—Ä–Ω–æ–º JSON –≤ `BinancePriceService` ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (warning/error), –≤—ã–±—Ä–æ—Å `BinanceApiException`; —Å–Ω–∞–ø—à–æ—Ç –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è. –í `PortfolioSnapshotCommand` ‚Äî –ø–µ—Ä–µ—Ö–≤–∞—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è, `logger->error`, –≤–æ–∑–≤—Ä–∞—Ç `Command::FAILURE` (cron –≤–∏–¥–∏—Ç –Ω–µ–Ω—É–ª–µ–≤–æ–π –∫–æ–¥). –ü–æ–ª–∏—Ç–∏–∫–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –≤ `config/packages/error_handling.yaml`.

9.2. **API**  
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ ‚Äî –æ—Ç–≤–µ—Ç 200 –∏ —Ç–µ–ª–æ `[]` (`PortfolioHistoryController`). –ü—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö ‚Äî 400 —Å JSON `{ "error": "..." }`. –ü–æ–ª–∏—Ç–∏–∫–∞ –≤ `config/packages/error_handling.yaml`.

---

## 10. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

10.1. **–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (–≤ –ø—Ä–æ–≥–æ–Ω–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)**  
‚úÖ `tests/Service/BinancePriceServiceTest.php` ‚Äî —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç, –Ω–µ-200, –Ω–µ–≤–µ—Ä–Ω—ã–π JSON.  
‚úÖ `tests/Service/PortfolioValuationServiceTest.php` ‚Äî —Ä–∞—Å—á—ë—Ç total_usdt, persist, –æ–±—Ä–∞–±–æ—Ç–∫–∞ UniqueConstraintViolation.  
–ó–∞–ø—É—Å–∫: `php vendor/bin/simple-phpunit` ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `tests/Service` (5 —Ç–µ—Å—Ç–æ–≤, –±–µ–∑ –ë–î). **–°—Ç–∞–±–∏–ª—å–Ω–æ –∑–µ–ª—ë–Ω—ã–π –Ω–∞ —Ö–æ—Å—Ç–µ –∏ –≤ CI.**

---

## 11. UI (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è: –∞–∫—Ç—É–∞–ª—å–Ω—ã–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –±–µ–∑ ¬´–∑–∞–≥–ª—É—à–µ–∫¬ª.

### 11.1. –¶–µ–ª–∏

- **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** ‚Äî –¥–∞—à–±–æ—Ä–¥: —Ç–µ–∫—É—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è (–ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–Ω–∞–ø—à–æ—Ç), –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–∏–æ–¥, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ –¥–∞–Ω–Ω—ã–º `GET /api/portfolio/history`.
- **–ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å**: —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞, —Ü–≤–µ—Ç–∞, –æ—Ç—Å—Ç—É–ø—ã, —Ç—ë–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞; –±–µ–∑ ¬´generic¬ª Bootstrap-–≤–∏–¥–∞.
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å**: —É–¥–æ–±–Ω–æ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –∏ –º–æ–±–∏–ª—å–Ω—ã—Ö.
- **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**: —Å–µ–º–∞–Ω—Ç–∏–∫–∞, –∫–æ–Ω—Ç—Ä–∞—Å—Ç, —Ñ–æ–∫—É—Å—ã, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.

### 11.2. –°—Ç–µ–∫ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–®–∞–±–ª–æ–Ω—ã**: Twig (Symfony), –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç `base.html.twig`.
- **–°—Ç–∏–ª–∏**: –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ CSS-—Ñ–∞–π–ª–æ–≤ –≤ `public/` –∏–ª–∏ –±–ª–æ–∫–∏ –≤ —à–∞–±–ª–æ–Ω–∞—Ö; –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ Node/build (–¥–æ–ø—É—Å—Ç–∏–º Tailwind CDN –∏–ª–∏ —á–∏—Å—Ç—ã–π CSS).
- **–ì—Ä–∞—Ñ–∏–∫**: –ª—ë–≥–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –±–µ–∑ —Å–±–æ—Ä–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä Chart.js —Å CDN), –¥–∞–Ω–Ω—ã–µ —Å `GET /api/portfolio/history?hours=N`.
- **–î–∞–Ω–Ω—ã–µ**: —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π API; –±–µ–∑ –Ω–æ–≤—ã—Ö backend-—ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –¥–ª—è UI (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å—ã/–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è –æ—Ç–¥–∞—á–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã).

### 11.3. –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ UI

| –®–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| 11.3.1 | **–ë–∞–∑–∞**: `base.html.twig` ‚Äî DOCTYPE, meta viewport, charset, title block, –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è CSS/JS, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä body. |
| 11.3.2 | **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞**: CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Ü–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç—ã, —Ä–∞–¥–∏—É—Å—ã, —Ç–µ–Ω–∏); —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å–≤–µ—Ç–ª–æ–π; —à—Ä–∏—Ñ—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –¥–ª—è —á–∏—Å–µ–ª (—á–∏—Ç–∞–µ–º—ã–π –º–æ–Ω–æ/–ø–æ–ª—É–º–æ–Ω–æ –¥–ª—è —Å—É–º–º). |
| 11.3.3 | **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–¥–∞—à–±–æ—Ä–¥)**: –±–ª–æ–∫ —Å ¬´—Ç–µ–∫—É—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é¬ª (–ø–æ—Å–ª–µ–¥–Ω—è—è —Ç–æ—á–∫–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∞ ¬´–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö¬ª); –±–ª–æ–∫ ¬´–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–∏–æ–¥¬ª (—Ä–∞–∑–Ω–∏—Ü–∞ –≤ % –º–µ–∂–¥—É –ø–µ—Ä–≤–æ–π –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç–æ—á–∫–æ–π –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞); –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–µ—Ä–∏–æ–¥–∞: 24—á, 7–¥, 30–¥ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ hours=24, 168, 720). |
| 11.3.4 | **–ì—Ä–∞—Ñ–∏–∫**: –∫–∞–Ω–≤–∞—Å/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥ Chart.js; –ª–∏–Ω–∏—è (line) –ø–æ –æ—Å—è–º –≤—Ä–µ–º—è (X) –∏ amount_usdt (Y); –ø–æ–¥–ø–∏—Å–∏ –ø–æ –æ—Å–∏ X ‚Äî –¥–∞—Ç–∞/–≤—Ä–µ–º—è –≤ —á–∏—Ç–∞–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ; –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–µ—Ä–∏–æ–¥–∞ ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ API –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞. |
| 11.3.5 | **–°–æ—Å—Ç–æ—è–Ω–∏—è**: –∑–∞–≥—Ä—É–∑–∫–∞ (skeleton –∏–ª–∏ —Å–ø–∏–Ω–Ω–µ—Ä), –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥¬ª), –æ—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ (—Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä). |
| 11.3.6 | **–ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ —Ñ—É—Ç–µ—Ä**: –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å—Å—ã–ª–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é), –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ API –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ; –≤ —Ñ—É—Ç–µ—Ä–µ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–≤–µ—Ä—Å–∏—è/–æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø–æ –∂–µ–ª–∞–Ω–∏—é). |

### 11.4. –§–∞–π–ª—ã –∏ –º–∞—Ä—à—Ä—É—Ç—ã

- **–ú–∞—Ä—à—Ä—É—Ç**: —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `GET /` (HomeController).
- **–®–∞–±–ª–æ–Ω—ã**: `templates/base.html.twig`, `templates/home/index.html.twig`.
- **–°—Ç–∞—Ç–∏–∫–∞**: –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ ‚Äî `public/css/app.css`, `public/js/portfolio-dashboard.js` (–∏–ª–∏ –∏–Ω–ª–∞–π–Ω –≤ —à–∞–±–ª–æ–Ω–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã).
- **API**: –≤—ã–∑–æ–≤—ã —Å —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (same-origin) –∫ `path('api_portfolio_history_index')` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `hours`.

### 11.5. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ UI

- –ù–∞ –≥–ª–∞–≤–Ω–æ–π –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è: –ø–æ—Å–ª–µ–¥–Ω—è—è –∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è –≤ USDT; –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤ %; –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –ø–æ –¥–∞–Ω–Ω—ã–º API.
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ (24—á / 7–¥ / 30–¥) –æ–±–Ω–æ–≤–ª—è–µ—Ç –≥—Ä–∞—Ñ–∏–∫ –∏ –±–ª–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —è–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –±–µ–∑ –ø–∞–¥–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∏–∑—É–∞–ª—å–Ω–æ —Ü–µ–ª—å–Ω—ã–π, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏ –ø—Ä–∏–≥–æ–¥–µ–Ω –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∫–∞–∫ ¬´–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π¬ª –¥–∞—à–±–æ—Ä–¥.

### 11.6. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç–∞—Ç—É—Å)

‚úÖ **–ë–∞–∑–∞**: `templates/base.html.twig` ‚Äî viewport, —à—Ä–∏—Ñ—Ç—ã Plus Jakarta Sans + JetBrains Mono, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ `public/css/app.css`.  
‚úÖ **–î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞**: `public/css/app.css` ‚Äî CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Ç—ë–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ —á–µ—Ä–µ–∑ `prefers-color-scheme`), –∫–∞—Ä—Ç–æ—á–∫–∏, –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–∏–æ–¥–∞, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞, —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏/–ø—É—Å—Ç–æ/–æ—à–∏–±–∫–∞.  
‚úÖ **–ì–ª–∞–≤–Ω–∞—è**: `templates/home/index.html.twig` ‚Äî –¥–∞—à–±–æ—Ä–¥: –¥–≤–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (—Ç–µ–∫—É—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–∏–æ–¥), –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å 24—á / 7–¥ / 30–¥, –±–ª–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞; JS –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `GET /api/portfolio/history?hours=N`, —Å—á–∏—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ % –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Ä–∏—Å—É–µ—Ç Chart.js (line), –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É/–ø—É—Å—Ç–æ/–æ—à–∏–±–∫—É.  
‚úÖ **–ì—Ä–∞—Ñ–∏–∫**: Chart.js 4 (CDN), –æ—Å—å X ‚Äî –¥–∞—Ç–∞/–≤—Ä–µ–º—è, –æ—Å—å Y ‚Äî amount_usdt; —Ü–≤–µ—Ç–∞ –∏–∑ CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.  
‚úÖ **–§—É—Ç–µ—Ä**: —Å—Å—ã–ª–∫–∞ –Ω–∞ API.

---

## 11.7. –ü–ª–∞–Ω: –ø—É—à –Ω–∞ —Ñ—Ä–æ–Ω—Ç, –±–ª–æ–∫ —Å–æ–±—ã—Ç–∏–π, –µ–¥–∏–Ω—ã–π –ª–æ–≥ –æ—à–∏–±–æ–∫

*(–ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –ø–æ —É–∫–∞–∑–∞–Ω–∏—é.)*

### –¶–µ–ª–∏

1. **–ü—É—à-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏**: –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–æ–≤—ã–π —Å–Ω–∞–ø—à–æ—Ç) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
2. **–ë–ª–æ–∫ —Å–æ–±—ã—Ç–∏–π –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã**: –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ —Å –Ω–æ–≤—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏ —Å–æ–±—ã—Ç–∏–π (—Å–Ω–∞–ø—à–æ—Ç —Å–æ–∑–¥–∞–Ω, –æ—à–∏–±–∫–∞ Binance –∏ —Ç.–¥.), –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏.
3. **–í—Å–µ –∑–Ω–∞—á–∏–º—ã–µ —Å–æ–±—ã—Ç–∏—è** –ø–∏—à—É—Ç—Å—è —á–µ—Ä–µ–∑ **LogManager** (–∫–∞–Ω–∞–ª –≤ –ë–î –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ).
4. **–ï–¥–∏–Ω—ã–π —Ñ–∞–π–ª –ª–æ–≥–∞ –æ—à–∏–±–æ–∫** –ø–æ –ø—Ä–æ–µ–∫—Ç—É: –≤—Å–µ –æ—à–∏–±–æ—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä `var/log/errors.log`).

---

### –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### A. –ï–¥–∏–Ω—ã–π –ª–æ–≥ –æ—à–∏–±–æ–∫

| –®–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| A.1 | –í `config/packages/monolog.yaml`: –¥–æ–±–∞–≤–∏—Ç—å handler **errors** (stream, path `%kernel.logs_dir%/errors.log`, level `error`), –ø—Ä–∏–≤—è–∑–∞—Ç—å –∫–æ –≤—Å–µ–º –∫–∞–Ω–∞–ª–∞–º (–∏–ª–∏ –∫ main), —á—Ç–æ–±—ã –ª—é–±–æ–π `$logger->error(...)` –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–ø–∞–¥–∞–ª –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª. |
| A.2 | –í `when@prod` –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ—Ç –∂–µ handler errors (–≤ prod ‚Äî –ø—É—Ç—å —á–µ—Ä–µ–∑ `%kernel.logs_dir%` –∏–ª–∏ —è–≤–Ω–æ `var/log/errors.log`). |

**‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**

–í `src/Service/LogManager.php` –ø—Ä–∏ —Ç–∏–ø–µ `file` –∏ –∏–º–µ–Ω–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`app`) –∫ –ª–æ–≥–≥–µ—Ä—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π handler: –∑–∞–ø–∏—Å—å –≤ `var/log/errors.log` —Å —É—Ä–æ–≤–Ω–µ–º `error`.
–í errors.log –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ —Ç–æ–≥–æ –ª–æ–≥–≥–µ—Ä–∞, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–ª–∏ –∏–º—è (–≤—ã–∑–æ–≤ `getLogger()` –±–µ–∑ –ø–µ—Ä–≤–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞).
–î–ª—è –ª—é–±–æ–≥–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ –∏–º–µ–Ω–∏ (portfolio, events –∏ —Ç.–¥.) –∑–∞–ø–∏—Å—å –≤ errors.log –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.
–í –∫–æ–Ω—Ñ–∏–≥–µ Monolog –æ—Ç–¥–µ–ª—å–Ω—ã–π handler –¥–ª—è errors –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

#### B. –°–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ LogManager –∏ API –¥–ª—è –±–ª–æ–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ

| –®–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| B.1 | **–ó–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π –≤ –ë–î —á–µ—Ä–µ–∑ LogManager**: –≤ –∫–æ–º–∞–Ω–¥–µ (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö) –≤—ã–∑—ã–≤–∞—Ç—å `LogManager::getLogger('events', 'db')` –∏ –ø–∏—Å–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è. LogManager –æ—Å—Ç–∞—ë—Ç—Å—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º: –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî –∏–º—è –ª–æ–≥–∞/—Ñ–∞–π–ª–∞/–∫–∞–Ω–∞–ª–∞ (–µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—Ç—å ‚Äî –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∏–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `app`). –î–ª—è –∂—É—Ä–Ω–∞–ª–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –ø–µ—Ä–µ–¥–∞—ë–º —è–≤–Ω–æ –∏–º—è `events`. |
| B.2 | **–ß—Ç–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∏–∑ –ë–î**: —Å–µ—Ä–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä `App\Service\AppLogReader` –∏–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –±–µ–∑ ORM-—Å—É—â–Ω–æ—Å—Ç–∏) ‚Äî –º–µ—Ç–æ–¥ `getRecentEvents(int $limit = 50): array`, –≤—ã–±–æ—Ä–∫–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `app_log` –ø–æ `channel = 'events'`, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ `created_at DESC`. –í–æ–∑–≤—Ä–∞—Ç –º–∞—Å—Å–∏–≤–∞ –∑–∞–ø–∏—Å–µ–π (id, channel, level, message, context, created_at). |
| B.3 | **API endpoint**: `GET /api/events` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –∑–∞–ø–∏—Å—è–º–∏ —Å–æ–±—ã—Ç–∏–π (–≤—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ –∏–∑ –ø. B.2). –õ–∏–º–∏—Ç –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `since_id` ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é –¥–ª—è –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ—Å—Ç–∏. |

**‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**

–í `src/Command/PortfolioSnapshotCommand.php` –≤–Ω–µ–¥—Ä—ë–Ω LogManager.
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ snapshot –∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (BinanceApiException, Throwable) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `$this->logManager->getLogger('events', 'db')` —Å –∑–∞–ø–∏—Å—å—é info –∏–ª–∏ error –≤ –∫–∞–Ω–∞–ª events –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±–ª–æ–∫–µ —Å–æ–±—ã—Ç–∏–π –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ.

–í `src/Service/AppLogReader.php` –¥–æ–±–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å —Å –º–µ—Ç–æ–¥–æ–º `getRecentEvents(int $limit = 50): array`.
–í—ã–±–∏—Ä–∞–µ—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `app_log` –∑–∞–ø–∏—Å–∏ –ø–æ `channel = 'events'`, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ `created_at DESC`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å –ø–æ–ª—è–º–∏ id, channel, level, message, context, created_at.

–í `src/Controller/Api/EventsController.php` –¥–æ–±–∞–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç `GET /api/events`.
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π query-–ø–∞—Ä–∞–º–µ—Ç—Ä `limit` (1‚Äì100, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50), –æ—Ç–¥–∞—ë—Ç JSON –º–∞—Å—Å–∏–≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ AppLogReader.

–í `config/services.yaml` —è–≤–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –¥–ª—è –∫–æ–º–∞–Ω–¥—ã –Ω–µ –º–µ–Ω—è–ª–∏—Å—å; LogManager –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è autowire.

#### C. –ü—É—à –Ω–∞ —Ñ—Ä–æ–Ω—Ç (—Ñ—Ä–æ–Ω—Ç —Å–ª—É—à–∞–µ—Ç –∫–∞–Ω–∞–ª, –±—ç–∫ —à–ª—ë—Ç –ø–æ –∫–∞–Ω–∞–ª—É)

| –®–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| C.1 | **–ú–æ–¥–µ–ª—å**: —Ñ—Ä–æ–Ω—Ç **–ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–Ω–∞–ª** (topic); –±—ç–∫ **–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ —ç—Ç–æ–º—É –∫–∞–Ω–∞–ª—É** –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–æ–≤—ã–π —Å–Ω–∞–ø—à–æ—Ç, –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ). –ù–∏–∫–∞–∫–æ–≥–æ –æ–ø—Ä–æ—Å–∞ (polling) —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã —Ñ—Ä–æ–Ω—Ç–∞. |
| C.2 | **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî Mercure**: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `symfony/mercure-bundle`, –ø–æ–¥–Ω—è—Ç—å Mercure Hub (–æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏–ª–∏ Docker-—Å–µ—Ä–≤–∏—Å). –ë—ç–∫ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–Ω–∞–ø—à–æ—Ç–∞ (–≤ –∫–æ–º–∞–Ω–¥–µ –∏–ª–∏ —Å–µ—Ä–≤–∏—Å–µ) –≤—ã–∑—ã–≤–∞–µ—Ç **Publisher** –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–æ–ø–∏–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä `portfolio/snapshots` (payload: `last_calculated_at`, `amount_usdt` –∏–ª–∏ –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç). |
| C.3 | **–§—Ä–æ–Ω—Ç**: –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–æ–ø–∏–∫ —á–µ—Ä–µ–∑ **EventSource** (Mercure JS API –∏–ª–∏ –Ω–∞—Ç–∏–≤–Ω—ã–π `EventSource` –Ω–∞ URL —Ö–∞–±–∞ —Å query-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `topic`). –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (¬´–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ—Ä—Ç—Ñ–µ–ª—é¬ª) –∏ –æ–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ (–ø–µ—Ä–µ–∑–∞–ø—Ä–æ—Å `GET /api/portfolio/history` —Å —Ç–µ–∫—É—â–∏–º –ø–µ—Ä–∏–æ–¥–æ–º –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞). |
| C.4 | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–æ–ø–∏–∫ –¥–ª—è —Å–æ–±—ã—Ç–∏–π (–∂—É—Ä–Ω–∞–ª) ‚Äî –±—ç–∫ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ `LogManager('events', 'db')` –¥—É–±–ª–∏—Ä—É–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏—é –≤ Mercure; —Ñ—Ä–æ–Ω—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ –±–ª–æ–∫ —Å–æ–±—ã—Ç–∏–π –±–µ–∑ –æ–ø—Ä–æ—Å–∞. |

**‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω symfony/mercure-bundle, –Ω–∞—Å—Ç—Ä–æ–µ–Ω config/packages/mercure.yaml (MERCURE_URL, MERCURE_PUBLIC_URL, MERCURE_JWT_SECRET).
- PortfolioValuationService::snapshot() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ?array —Å calculated_at –∏ amount_usdt –ø—Ä–∏ —É—Å–ø–µ—Ö–µ, null –ø—Ä–∏ UniqueConstraintViolation.
- PortfolioSnapshotCommand –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ snapshot –ø—Ä–∏ $data !== null –ø—É–±–ª–∏–∫—É–µ—Ç –≤ Mercure —Ç–æ–ø–∏–∫ portfolio/snapshots (HubInterface).
- –í dev-compose.yml –¥–æ–±–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å mercure (dunglas/mercure), –ø–æ—Ä—Ç 3000; —É app –∑–∞–¥–∞–Ω—ã Mercure env –∏ depends_on: mercure.
- –í Twig –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è mercure_public_url (config/packages/twig.yaml).
- –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è toast, JS –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–æ–ø–∏–∫ portfolio/snapshots —á–µ—Ä–µ–∑ EventSource (MERCURE_PUBLIC_URL + topic); –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è ‚Äî –ø–æ–∫–∞–∑ toast ¬´–ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ—Ä—Ç—Ñ–µ–ª—é¬ª –∏ –≤—ã–∑–æ–≤ load(currentHours) –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –∏ –∫–∞—Ä—Ç–æ—á–µ–∫.
- –°—Ç–∏–ª–∏ .toast –∏ .toast.hidden –≤ public/css/app.css.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Mercure (–∏—Ç–æ–≥–æ–≤–∞—è —Ä–∞–±–æ—á–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è):**

- **–ü–æ–¥–ø–∏—Å–∫–∞ —Å JWT:** URL –ø–æ–¥–ø–∏—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Twig `mercure(['portfolio/snapshots'], { subscribe: ['portfolio/snapshots'] })` ‚Äî –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è cookie `mercureAuthorization` —Å JWT –ø–æ–¥–ø–∏—Å—á–∏–∫–∞; –±–µ–∑ –Ω–µ—ë —Ö–∞–± –Ω–µ –æ—Ç–¥–∞—ë—Ç SSE-—Å—Ç—Ä–∏–º.
- **–û–¥–∏–Ω origin:** –ø–æ–¥–ø–∏—Å–∫–∞ –∏–¥—ë—Ç –Ω–∞ `http://localhost:8080/.well-known/mercure` (–Ω–µ –Ω–∞ –ø–æ—Ä—Ç 3000). –í nginx –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ app (`docker/nginx/default.conf`) –¥–æ–±–∞–≤–ª–µ–Ω `location /.well-known/mercure` —Å proxy_pass –Ω–∞ `http://mercure:3000`; proxy_buffering off, –¥–ª–∏–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã, –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è SSE. –í compose —É app: MERCURE_PUBLIC_URL=http://localhost:8080/.well-known/mercure, MERCURE_URL=http://mercure:3000/.well-known/mercure.
- **Mercure (Caddy):** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω—ã–π Caddyfile `docker/mercure/Caddyfile` (–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä): –ø–æ—Ä—Ç 3000, `bind 0.0.0.0`, –±–ª–æ–∫ mercure —Å publisher_jwt/subscriber_jwt –∏–∑ env, `anonymous`, `cors_origins`, `heartbeat 15s`; –±–µ–∑ `encode` (gzip), —á—Ç–æ–±—ã –Ω–µ –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞—Ç—å SSE. –í dev-compose —Å–µ—Ä–≤–∏—Å mercure: volumes Caddyfile, env MERCURE_PUBLISHER_JWT_KEY –∏ MERCURE_SUBSCRIBER_JWT_KEY –∏–∑ MERCURE_JWT_SECRET.
- **Cron –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ cron –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (MERCURE_* –∏ —Ç.–¥.), –∏–∑‚Äë–∑–∞ —á–µ–≥–æ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–µ —É—Ö–æ–¥–∏–ª–∞. –í entrypoint –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ cron —Å–æ–∑–¥–∞—ë—Ç—Å—è `/etc/portfolio-snapshot.env` —Å APP_ENV, MERCURE_URL, MERCURE_PUBLIC_URL, MERCURE_JWT_SECRET; —Å–∫—Ä–∏–ø—Ç `portfolio-snapshot-cron.sh` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º PHP –¥–µ–ª–∞–µ—Ç `source /etc/portfolio-snapshot.env`, —á—Ç–æ–±—ã –∫–æ–º–∞–Ω–¥–∞ –∏–º–µ–ª–∞ —Ç–æ –∂–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, —á—Ç–æ –∏ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∑–∞–ø—É—Å–∫–µ.
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —á–µ–∫–ª–∏—Å—Ç ‚Äî –≤ —Ñ–∞–π–ª–µ **MERCURE-SOLUTION.md**.

#### D. –ë–ª–æ–∫ —Å–æ–±—ã—Ç–∏–π –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã

| –®–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| D.1 | –ù–∞ –≥–ª–∞–≤–Ω–æ–π (–≤ `templates/home/index.html.twig`) –¥–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ **¬´–°–æ–±—ã—Ç–∏—è¬ª** (–∏–ª–∏ ¬´–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π¬ª) –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º: –∑–∞–≥–æ–ª–æ–≤–æ–∫, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–ø–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π. |
| D.2 | JS —Ä–∞–∑ –≤ N —Å–µ–∫—É–Ω–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä 10 —Å) –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `GET /api/events`, —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–ø–∏—Å–æ–∫ (–¥–∞—Ç–∞/–≤—Ä–µ–º—è, —É—Ä–æ–≤–µ–Ω—å, —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç). –ù–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ ‚Äî —Å–≤–µ—Ä—Ö—É. –°—Ç–∏–ª–∏ –≤ `app.css` –ø–æ–¥ –±–ª–æ–∫ —Å–æ–±—ã—Ç–∏–π. |
| D.3 | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –≤ –±–ª–æ–∫–µ —Å–æ–±—ã—Ç–∏–π –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å –µ—ë (–∞–Ω–∏–º–∞—Ü–∏—è –∏–ª–∏ –º–µ—Ç–∫–∞ ¬´–Ω–æ–≤–æ–µ¬ª). |

**‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ù–∞ –≥–ª–∞–≤–Ω–æ–π –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è ¬´–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π¬ª: –∑–∞–≥–æ–ª–æ–≤–æ–∫, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ø–∏—Å–∫–∞, —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∞/–ø—É—Å—Ç–æ (templates/home/index.html.twig).
- JS –∫–∞–∂–¥—ã–µ 10 —Å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç GET /api/events?limit=20, —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–ø–∏—Å–æ–∫: –¥–∞—Ç–∞/–≤—Ä–µ–º—è (locale ru-RU), —É—Ä–æ–≤–µ–Ω—å, —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏; –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ —Å–≤–µ—Ä—Ö—É (API –æ—Ç–¥–∞—ë—Ç DESC).
- –°—Ç–∏–ª–∏ –±–ª–æ–∫–∞: .events-section, .events-list, .events-item, .events-item__time/__level/__message/__context, .events-item--error –¥–ª—è level error (public/css/app.css).
- –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ (–∏–∑–º–µ–Ω–∏–ª—Å—è –ø–µ—Ä–≤—ã–π id –∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ) –≤–µ—Ä—Ö–Ω—è—è –∑–∞–ø–∏—Å—å –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç—Å—è –∫–ª–∞—Å—Å–æ–º .events-item--new (–∞–Ω–∏–º–∞—Ü–∏—è), —Å–Ω—è—Ç–∏–µ —á–µ—Ä–µ–∑ 3 —Å.

#### E. –§–∞–π–ª—ã –∏ —Å—É—â–Ω–æ—Å—Ç–∏

| –ß—Ç–æ | –ì–¥–µ |
|-----|-----|
| Monolog: handler errors | `config/packages/monolog.yaml` (+ when@prod) |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ –ë–î | `PortfolioSnapshotCommand` (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å—ã) ‚Äî –≤–Ω–µ–¥—Ä–∏—Ç—å `LogManager`, –≤—ã–∑—ã–≤–∞—Ç—å `getLogger('events', 'db')` |
| –ß—Ç–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π | `App\Service\AppLogReader` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥ (DBAL/Connection, –∑–∞–ø—Ä–æ—Å –∫ `app_log`) |
| API —Å–æ–±—ã—Ç–∏–π | `App\Controller\Api\EventsController` –∏–ª–∏ –º–µ—Ç–æ–¥ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º API-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ ‚Äî `GET /api/events` |
| Mercure: –∫–æ–Ω—Ñ–∏–≥, –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –±—ç–∫–µ | `config/packages/mercure.yaml`, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ `HubInterface` –≤ –∫–æ–º–∞–Ω–¥—É, –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å–ª–µ —Å–Ω–∞–ø—à–æ—Ç–∞ –≤ —Ç–æ–ø–∏–∫ `portfolio/snapshots` |
| –§—Ä–æ–Ω—Ç: –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª, toast, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ | `templates/home/index.html.twig` + JS: EventSource –Ω–∞ Mercure hub, –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—Ä–æ—Å history + –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ |
| –§—Ä–æ–Ω—Ç: –±–ª–æ–∫ —Å–æ–±—ã—Ç–∏–π | —Ç–æ—Ç –∂–µ —à–∞–±–ª–æ–Ω: –ª–∏–±–æ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–æ–ø–∏–∫ —Å–æ–±—ã—Ç–∏–π (–ø—É—à), –ª–∏–±–æ —Ä–∞–∑–æ–≤–∞—è/—Ä–µ–¥–∫–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ `GET /api/events` –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏ –ø–æ –ø—É—à—É |
| –°—Ç–∏–ª–∏ –±–ª–æ–∫–∞ —Å–æ–±—ã—Ç–∏–π –∏ toast | `public/css/app.css` |

**‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ï–¥–∏–Ω—ã–π –ª–æ–≥ –æ—à–∏–±–æ–∫: –≤ `LogManager` –¥–ª—è –ª–æ–≥–≥–µ—Ä–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`app`, type=file) –¥–æ–±–∞–≤–ª–µ–Ω –≤—Ç–æ—Ä–æ–π handler ‚Äî –∑–∞–ø–∏—Å—å –≤ `var/log/errors.log` (—É—Ä–æ–≤–µ–Ω—å error); –æ—Ç–¥–µ–ª—å–Ω—ã–π handler –≤ monolog.yaml –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ –ë–î: `PortfolioSnapshotCommand` –≤–Ω–µ–¥—Ä—è–µ—Ç `LogManager`, –≤—ã–∑—ã–≤–∞–µ—Ç `getLogger('events', 'db')->info()` / `->error()` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –∏ –æ—à–∏–±–∫–∞—Ö.
- –ß—Ç–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π: `App\Service\AppLogReader` (DBAL Connection), –º–µ—Ç–æ–¥ `getRecentEvents(int $limit)`, –∑–∞–ø—Ä–æ—Å –∫ `app_log` –ø–æ –∫–∞–Ω–∞–ª—É events.
- API —Å–æ–±—ã—Ç–∏–π: `App\Controller\Api\EventsController`, `GET /api/events`, query `limit` (1‚Äì100), –æ—Ç–≤–µ—Ç JSON –∏–∑ AppLogReader.
- Mercure: –∫–æ–Ω—Ñ–∏–≥ –≤ `config/packages/mercure.yaml`; –≤ `PortfolioSnapshotCommand` –≤–Ω–µ–¥—Ä—ë–Ω `HubInterface`, –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ snapshot ‚Äî `$hub->publish(new Update('portfolio/snapshots', json_encode($data)))`.
- –§—Ä–æ–Ω—Ç –ø–æ–¥–ø–∏—Å–∫–∞ –∏ toast: –≤ `templates/home/index.html.twig` ‚Äî EventSource –Ω–∞ MERCURE_PUBLIC_URL?topic=portfolio/snapshots, –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ toast –∏ –≤—ã–∑–æ–≤ load(currentHours).
- –§—Ä–æ–Ω—Ç –±–ª–æ–∫ —Å–æ–±—ã—Ç–∏–π: –≤ —Ç–æ–º –∂–µ —à–∞–±–ª–æ–Ω–µ ‚Äî —Å–µ–∫—Ü–∏—è ¬´–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π¬ª, –æ–ø—Ä–æ—Å `GET /api/events` –∫–∞–∂–¥—ã–µ 10 —Å, —Ä–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞.
- –°—Ç–∏–ª–∏: –±–ª–æ–∫ —Å–æ–±—ã—Ç–∏–π –∏ toast –≤ `public/css/app.css`.

#### F. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

- **–ü—É—à**: —Ñ—Ä–æ–Ω—Ç –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª (Mercure); –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–Ω–∞–ø—à–æ—Ç–∞ –±—ç–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª; —Ñ—Ä–æ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –µ–≥–æ, 
- –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≥—Ä–∞—Ñ–∏–∫ –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.
- –í–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –±–ª–æ–∫ —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞, –æ—à–∏–±–∫–∏); –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –ø—É—à—É (–∏–ª–∏ –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ –Ω–∞ —Ç–æ–ø–∏–∫ —Å–æ–±—ã—Ç–∏–π).
- –í—Å–µ —Ç–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –ø–∏—à—É—Ç—Å—è —á–µ—Ä–µ–∑ LogManager (–Ω–∞–ø—Ä–∏–º–µ—Ä `getLogger('events', 'db')`); –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–º—è —Ñ–∞–π–ª–∞/–∫–∞–Ω–∞–ª–∞ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è, –∏–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (LogManager –æ—Å—Ç–∞—ë—Ç—Å—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º).
- –í—Å–µ –æ—à–∏–±–æ—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª `var/log/errors.log` (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Monolog).

---

## 12. –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **KIS**: –æ–¥–∏–Ω —Å–Ω–∞–ø—à–æ—Ç –Ω–∞ —á–∞—Å, –æ–¥–∏–Ω endpoint, –º–∏–Ω–∏–º—É–º —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
- **DRY**: –æ–±—â–∏–π HTTP-–∫–ª–∏–µ–Ω—Ç –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ; —Ñ–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞ —Ç–æ–ª—å–∫–æ –≤ PortfolioValuationService; –≤—ã–±–æ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –∏–Ω–¥–µ–∫—Å –ø–æ `calculated_at`; –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä—ë–º–µ –¥–∞–Ω–Ω—ã—Ö ‚Äî –ª–∏–º–∏—Ç –Ω–∞ `hours`/–¥–∏–∞–ø–∞–∑–æ–Ω –∏ –≤—ã–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ DTO/array hydration).
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –≥–æ–≤–æ—Ä—è—â–∏–µ –∏–º–µ–Ω–∞ –∫–ª–∞—Å—Å–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤; —Ç–∏–ø-—Ö–∏–Ω—Ç—ã –≤–µ–∑–¥–µ; –∫–æ—Ä–æ—Ç–∫–∏–µ –º–µ—Ç–æ–¥—ã; –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏ –æ—à–∏–±–æ–∫.
- **–°—Ç–µ–∫**: —Ç–æ–ª—å–∫–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ (Symfony 7.4, Doctrine ORM, –∞—Ç—Ä–∏–±—É—Ç—ã, —Å–µ—Ä–≤–∏—Å—ã –∏–∑ `src/` —Å autowire).
- **–ü—Ä–∏–Ω—Ü–∏–ø—ã:** –ª–æ–≥–∏–∫–∞ ‚Äî –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö (–æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏ –∫–ª–∞—Å—Å—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏); –≤–∞–ª–∏–¥–∞—Ü–∏—è ‚Äî –≤ Request-–∫–ª–∞—Å—Å–∞—Ö, –Ω–µ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö.

---

## 13. –ó–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á–∏

–§–∞–π–ª—ã —Ä–∞–∑–±–∏—Ç—ã –ø–æ —Ç–∏–ø–∞–º (–±–µ–∑ —É—á—ë—Ç–∞ `vendor/` –∏ —Ñ–∞–π–ª–æ–≤ —Å `_old` –≤ –∏–º–µ–Ω–∏).

### Backend (PHP)

| –†–æ–ª—å | –§–∞–π–ª |
|------|------|
| –°—É—â–Ω–æ—Å—Ç—å | `src/Entity/PortfolioSnapshot.php` |
| –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π | `src/Repository/PortfolioSnapshotRepository.php` |
| –°–µ—Ä–≤–∏—Å—ã | `src/Service/PortfolioValuationService.php`, 
`src/Service/Binance/BinancePriceService.php`, 
`src/Service/Binance/BinancePriceServiceInterface.php`, 
`src/Service/LogManager.php`, 
`src/Service/AppLogReader.php` |
| –ö–æ–º–∞–Ω–¥–∞ | `src/Command/PortfolioSnapshotCommand.php` |
| API-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã | `src/Controller/Api/PortfolioHistoryController.php`, `src/Controller/Api/EventsController.php`, `src/Controller/Api/PortfolioBreakdownController.php` |
| Web-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä | `src/Controller/Web/HomeController.php` |
| –ò—Å–∫–ª—é—á–µ–Ω–∏–µ | `src/Exception/BinanceApiException.php` |
| –Ø–¥—Ä–æ | `src/Kernel.php` |

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –§–∞–π–ª |
|------------|------|
| –°–µ—Ä–≤–∏—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | `config/services.yaml` |
| –ú–∞—Ä—à—Ä—É—Ç—ã | `config/routes.yaml`, `config/routes/framework.yaml` |
| –ü–æ—Ä—Ç—Ñ–µ–ª—å –∏ Binance | `config/packages/portfolio.yaml` |
| API –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è | `config/packages/portfolio_history_api.yaml` |
| API —Å–æ–±—ã—Ç–∏–π | `config/packages/events_api.yaml` |
| Mercure | `config/packages/mercure.yaml` |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | `config/packages/monolog.yaml` |
| Cron (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | `config/packages/cron.yaml` |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | `config/packages/error_handling.yaml` |
| –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã | `config/packages/framework.yaml`, `config/packages/doctrine.yaml`, `config/packages/doctrine_migrations.yaml`, `config/packages/twig.yaml`, `config/packages/cache.yaml`, `config/packages/routing.yaml` |
| Bundles | `config/bundles.php` |

### –®–∞–±–ª–æ–Ω—ã (Twig)

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `templates/base.html.twig` | –ë–∞–∑–æ–≤—ã–π layout, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π |
| `templates/home/index.html.twig` | –ì–ª–∞–≤–Ω–∞—è: –∫–∞—Ä—Ç–æ—á–∫–∏, –≥—Ä–∞—Ñ–∏–∫, –∂—É—Ä–Ω–∞–ª —Å—Ç–æ–∏–º–æ—Å—Ç–∏, Mercure, –ø–µ—Ä–∏–æ–¥ 10 –º–∏–Ω / 1 —á / 24 —á |

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ (—Å—Ç–∞—Ç–∏—á–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã)

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `public/css/app.css` | –°—Ç–∏–ª–∏: –∫–∞—Ä—Ç–æ—á–∫–∏, –≥—Ä–∞—Ñ–∏–∫, –∂—É—Ä–Ω–∞–ª, toast, Mercure, —Ñ–æ—Ä–º—É–ª–∞, dashboard-row |
| `public/index.php` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |

### Docker –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `dev-compose.yml` | –°–µ—Ä–≤–∏—Å—ã app, nginx, mercure, –ë–î; –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è cron –∏ Mercure |
| `docker/entrypoint.sh` | –ó–∞–ø—É—Å–∫ cron/—Ü–∏–∫–ª–∞, —Å–æ–∑–¥–∞–Ω–∏–µ `portfolio-snapshot.env` –¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã —Å–Ω–∞–ø—à–æ—Ç–∞ |
| `docker/mercure/Caddyfile` | Mercure hub: –ø–æ—Ä—Ç 3000, JWT, heartbeat, CORS |
| `docker/nginx/default.conf` | –ü—Ä–æ–∫—Å–∏ `/.well-known/mercure` –Ω–∞ mercure:3000 |
| `docker/php/php.ini` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PHP –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ |
| `docker/php/www.conf` | –ö–æ–Ω—Ñ–∏–≥ PHP-FPM (–ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏) |
| `.env` / `.env.local` | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø–æ—Ä—Ç—Ñ–µ–ª—å, Binance, Mercure, cron, –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å) |

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `migrations/Version20250228140000_CreateAppLogTable.php` | –¢–∞–±–ª–∏—Ü–∞ `app_log` –¥–ª—è —Å–æ–±—ã—Ç–∏–π |
| `migrations/Version20250228160000_CreatePortfolioSnapshotTable.php` | –¢–∞–±–ª–∏—Ü–∞ `portfolio_snapshot` |

### –§–∞–π–ª—ã –ª–æ–≥–æ–≤ (–æ—Å—Ç–∞–≤—à–∏–µ—Å—è)

–ü—É—Ç–∏ ‚Äî –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (–≤ Docker ‚Äî `/var/www/html/`).

| –§–∞–π–ª / –º–µ—Å—Ç–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------------|----------|
| `var/log/dev.log` | –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ dev (Monolog main): –∑–∞–ø—Ä–æ—Å—ã, —Ä–æ—É—Ç–∏–Ω–≥, –∫–æ–º–∞–Ω–¥–∞ —Å–Ω–∞–ø—à–æ—Ç–∞ –∏ Binance (LoggerInterface). |
| `var/log/errors.log` | –û—à–∏–±–∫–∏ –ª–æ–≥–≥–µ—Ä–∞ `app` (LogManager, getLogger('app', 'file') / getLogger()) ‚Äî —É—Ä–æ–≤–µ–Ω—å Error. |
| `var/log/cron_snapshot.log` | –í—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã —Å–Ω–∞–ø—à–æ—Ç–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–æ cron –≤ Docker (entrypoint, —Å–∫—Ä–∏–ø—Ç portfolio-snapshot-cron.sh). |
| –¢–∞–±–ª–∏—Ü–∞ `app_log` | –°–æ–±—ã—Ç–∏—è —Å–Ω–∞–ø—à–æ—Ç–∞ (LogManager, type=db): —É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∏ –∫–æ–º–∞–Ω–¥—ã; –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏, API GET /api/events. |

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `main-task.md` | –¢–ó, —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è, –∂—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ |
| `TEST-RUNBOOK.md` | –ü–æ—à–∞–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –º–∏–≥—Ä–∞—Ü–∏–∏, API, –¥–∞—à–±–æ—Ä–¥) |
| `MERCURE-SOLUTION.md` | –†–∞–∑–±–æ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Mercure –∏ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º |
| `CODE_REVIEW_IMPROVEMENTS.md` | –ê—É–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç–∞: –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏, SOLID, DRY |
